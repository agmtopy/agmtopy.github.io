---
title: mybatis插件机制
date: 2018-04-23 21:56:33
categories: mybatis
tags:
    - mybatis
---

# mybatis插件机制

mybatis框架支持通过插件机制来扩展功能，分别提供了4种扩展点：
1. Executor ： mybatis的执行器，用于执行curd操作
2. StatementHandler：数据库处理对象，用于执行sql操作 
3. ParameterHandler：处理参数对象
4. ResultSetHandler：处理返回结果集

其中**executor**和**statementHandler**的区别在于executor是使用connection的一方，statementHandler通过对connection进行封装。

## 插件的基本原理
通过责任链的模式对请求进行处理，使用代理模式对目标类进行增强从而达到处理的目的。

## 插件的注册时机？
插件是在configation.newParameterHandler/newResultSetHandler/newStatementHandler/newExecutor方法中会注册拦截器插件
![J09Llt.png](https://s1.ax1x.com/2020/04/23/J09Llt.png)

## 插件的执行时机？

```java
  @Override
  public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
    try {
      Set<Method> methods = signatureMap.get(method.getDeclaringClass());
      if (methods != null && methods.contains(method)) {
        return interceptor.intercept(new Invocation(target, method, args));
      }
      return method.invoke(target, args);
    } catch (Exception e) {
      throw ExceptionUtil.unwrapThrowable(e);
    }
  }

```

从**Plugin**中的invoker方法可以看出具体执行插件的方法是在代理类执行的时候会判断时候有插件如果有插件就执行插件中的方法并返回。


