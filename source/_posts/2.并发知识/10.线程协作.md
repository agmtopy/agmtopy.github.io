---
title: çº¿ç¨‹åä½œ
date: 2017-06-12 21:53:34
categories: javaå¹¶å‘
tags:
  - çº¿ç¨‹åä½œ
---

# çº¿ç¨‹åä½œ
çº¿ç¨‹ä¹‹é—´ç›¸äº’åä½œ

## ä¿¡å·é‡

çº¿ç¨‹ï¼ˆsemaphoreï¼‰ä¹‹é—´ä¿¡å·é‡çš„ä½œç”¨æ˜¯äºæ ‡è®°å½“å‰èµ„æºèƒ½å¦è¢«çº¿ç¨‹è®¿é—®çš„ä¿¡å·ã€‚çº¿ç¨‹è®¿é—®èµ„æºæ—¶å°è¯•ç”¨**acquire**ï¼Œè®¿é—®å®Œæˆä½¿ç”¨**release**å½’è¿˜èµ„æº

## countDownLatch
**countDownLatch**çš„ä½œç”¨æ˜¯å¤šçº¿ç¨‹ä¹‹é—´çš„å€’è®¡æ—¶å™¨ï¼Œç”¨äºå¤šçº¿ç¨‹ä¹‹é—´çš„åä½œã€‚æœ‰ä¸¤ç§ç”¨æ³•ï¼š
1. ä¸»çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹è¿è¡Œå®Œæ¯•åæ‰§è¡Œ
2. å…¶ä»–çº¿ç¨‹ç­‰å¾…ä¸»çº¿ç¨‹è¿è¡Œå®Œæ¯•åæ‰§è¡Œ

- æ¼”ç¤ºä»£ç 
```java
    public static void main(String[] args) throws InterruptedException {
          private static final ThreadPoolExecutor threadPool = new ThreadPoolExecutor(2, 2, 0, TimeUnit.SECONDS, new LinkedBlockingDeque<>(), new ThreadFactoryBuilder().setNameFormat("çº¿ç¨‹_%s").build());

        CountDownLatch count = new CountDownLatch(2);
        for (int i = 0; i < 2; i++) {
            threadPool.submit(() -> {
                String msg = String.format("%så¼€å§‹æ‰§è¡Œ...", Thread.currentThread().getName());
                System.out.println(msg);
                count.countDown();
            });
        }
        count.await();
        System.out.println(Thread.currentThread().getName() + "æ‰§è¡Œå®Œæ¯•...");
    }
````
![GZRSF1.png](https://s1.ax1x.com/2020/03/29/GZRSF1.png)


## CyclicBarriar
**CyclicBarriar**æ˜¯ä¸€ç»„çº¿ç¨‹åˆ°è¾¾æŸä¸ªçŠ¶æ€åæ‰å¼€å§‹æ‰§è¡Œ,ä¸**CountDownLatch**ä¸åŒã€‚**CountDownLatch**æ˜¯è¾¾åˆ°count=0ä»¥åå¼€å§‹æ‰§è¡Œï¼Œæ˜¯ä½œç”¨äº**äº‹ä»¶**é©±åŠ¨ã€‚**CyclicBarriar**æ˜¯çº¿ç¨‹é©±åŠ¨ï¼ŒNä¸ªçº¿ç¨‹åˆ°è¾¾**wait**çš„çŠ¶æ€ç»Ÿä¸€å¼€å§‹æ‰§è¡Œã€‚

- CyclicBarriaræ¼”ç¤ºä»£ç 

```java
public class CyclicBarriarDemo {

    private static final ThreadPoolExecutor threadPool = new ThreadPoolExecutor(1, Integer.MAX_VALUE, 0, TimeUnit.SECONDS, new SynchronousQueue<>(), new ThreadFactoryBuilder().setNameFormat("çº¿ç¨‹_%s").build());

    public static void main(String[] args) {
        CyclicBarrier cyclicBarrier = new CyclicBarrier(3);
        for (int i = 0; i < 6; i++) {
            int finalI1 = i;
            threadPool.submit(() -> {
                String msg1 = String.format("[%s]-å°è€é¼ [%d]å¼€å§‹å‡ºæ´", Thread.currentThread().getName(), finalI1);
                System.out.println(msg1);
                Integer sleepTime = ThreadLocalRandom.current().nextInt(10);
                try {
                    TimeUnit.SECONDS.sleep(sleepTime);
                    String msg2 = String.format("[%s]-å°è€é¼ [%d]åˆ°è¾¾æŒ‡å®šåœ°ç‚¹", Thread.currentThread().getName(), finalI1);
                    System.out.println(msg2);
                    cyclicBarrier.await();
                    String msg3 = String.format("[%s]-å°è€é¼ [%d]åˆåŠ›è·å–åˆ°å¥¶é…ª(ğŸ§€)", Thread.currentThread().getName(), finalI1);
                    System.out.println(msg3);
                } catch (InterruptedException | BrokenBarrierException e) {
                    e.printStackTrace();
                }
            });
        }
    }
}
```

- æ‰§è¡Œç»“æœ
![GZ57WR.png](https://s1.ax1x.com/2020/03/29/GZ57WR.png)

- æœ‰å¯å§‹åŠ¨ä½œçš„æ–¹æ³•

```java
    CyclicBarrier cyclicBarrier = new CyclicBarrier(3,()->{
        String msg1 = String.format("[%s]-å‘ç°å¥¶é…ª(ğŸ§€)", Thread.currentThread().getName());
        System.out.println(msg1);
    });
```

- æ‰§è¡Œç»“æœ

![GZIufs.png](https://s1.ax1x.com/2020/03/29/GZIufs.png)

## Condittion

**Condittion**èƒ½è®©ä¸åŒçº¿ç¨‹ä¹‹é—´ç›¸äº’åä½œï¼Œç­‰å¾…æ»¡è¶³æ¡ä»¶åç»§ç»­æ‰§è¡Œã€‚

```java
public class ConditionDemo {
    private ReentrantLock lock = new ReentrantLock();
    private Condition condition = lock.newCondition();

    public static void main(String[] args) throws InterruptedException {
        ConditionDemo conditionDemo = new ConditionDemo();

        new Thread(() ->{
            try {
                conditionDemo.method1();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }).start();

        conditionDemo.method0();
    }

    public void method0() throws InterruptedException {
        lock.lock();
        try {
            System.out.println(Thread.currentThread().getName() + ":æ¡ä»¶æœªå‡†å¤‡å®Œæ¯•...");
            condition.await();
            System.out.println(Thread.currentThread().getName() + ":å¼€å§‹æ‰§è¡Œ...");
        }
        finally {
            lock.unlock();
        }
    }

    public void method1() throws InterruptedException {
        lock.lock();
        try {
            System.out.println(Thread.currentThread().getName() + ":æ¡ä»¶å‡†å¤‡å®Œæ¯•...");
            condition.signal();
        }finally {
            lock.unlock();
        }
    }
}
```

**Condition**æ˜¯locké”æä¾›çš„ä¸€ç§å¯ä¾›çº¿ç¨‹ä¹‹é—´è¿›è¡Œäº¤äº’çš„ä¸€ç§æ–¹æ³•ã€‚ç”±äº**signal**åº•å±‚ä¼šä½¿ç”¨åˆ°å½“å‰çº¿ç¨‹å’Œlocké”çš„æŒæœ‰çº¿ç¨‹è¿›è¡Œå¯¹æ¯”ï¼Œç›¸ç­‰æ‰ä¼šè¿›è¡Œå”¤é†’å…¶ä»–çº¿ç¨‹ã€‚



# æ€»ç»“

- **semaphore**
ä¿¡å·é‡çš„ä½œç”¨æ˜¯åªæœ‰è·å¾—ä¿¡å·é‡çš„çº¿ç¨‹æ‰èƒ½**æ‰§è¡Œ**ï¼Œå…¶ä½™çº¿ç¨‹åªèƒ½ç­‰å¾…æŒæœ‰ä¿¡å·é‡çš„çº¿ç¨‹é‡Šæ”¾åæ‰æœ‰æœºä¼šæ‰§è¡Œã€‚

- **countDownLatch**æ˜¯ç­‰å¾…ä¸€ç»„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åç­‰å¾…çº¿ç¨‹æ‰å¯ä»¥æ‰§è¡Œï¼Œæ˜¯äº‹ä»¶è§¦å‘

- **CyclicBarriar**æ˜¯ä¸€ç»„çº¿ç¨‹åˆ°è¾¾**wait()**çŠ¶æ€ä»¥åæ‰å¯ä»¥å¼€å§‹æ‰§è¡Œï¼Œè§¦å‘åŠ¨ä½œæ˜¯è®¾å®šçš„ä¸€ç»„çº¿ç¨‹éƒ½åˆ°è¾¾æŸä¸ªä¸´ç•ŒçŠ¶æ€ï¼Œå¹¶ä¸”å¯è¢«å¤ç”¨ï¼Œ

